<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mailbox</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    body { background: #f5f7fa; }
    .mail-container { display: flex; gap: 20px; margin-top: 20px; }
    .mail-list { flex: 1; max-width: 300px; }
    .mail-view { flex: 2; border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: white; }
    .list-group-item { cursor: pointer; }
  </style>
</head>
<body>
  <div class="d-flex justify-content-between align-items-center p-3 bg-dark text-white">
    <h5 class="mb-0">{{ email }}</h5>
    <a href="{{ url_for('logout') }}" class="btn btn-sm btn-danger">Logout</a>
  </div>

  <div class="container mail-container">
    <div class="mail-list">
      <h6 class="bg-success text-white p-2">Inbox (last 20)</h6>
      <ul class="list-group">
        {% for mail in inbox %}
          <li class="list-group-item" onclick="showMessage('{{ loop.index0 }}', 'inbox')">
            <b>{{ mail.subject }}</b><br>
            <small>{{ mail.date }}</small>
          </li>
        {% endfor %}
      </ul>
    </div>

    <div class="mail-list">
      <h6 class="bg-danger text-white p-2">Spam (last 20)</h6>
      <ul class="list-group">
        {% for mail in spam %}
          <li class="list-group-item" onclick="showMessage('{{ loop.index0 }}', 'spam')">
            <b>{{ mail.subject }}</b><br>
            <small>{{ mail.date }}</small>
          </li>
        {% endfor %}
      </ul>
    </div>

    <div class="mail-view" id="message-view">
      <h6>Message</h6>
      <p>Select a subject to read.</p>
    </div>
  </div>

  <script>
    const inbox = {{ inbox|tojson }};
    const spam = {{ spam|tojson }};

    function showMessage(idx, folder) {
      let mail = folder === 'inbox' ? inbox[idx] : spam[idx];
      document.getElementById("message-view").innerHTML =
        `<h4>${mail.subject}</h4>
         <b>From:</b> ${mail.from}<br>
         <b>Date:</b> ${mail.date}<hr>
         ${mail.body}`;
    }
  </script>
</body>
</html>
